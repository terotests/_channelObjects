(function(){var t={},r=function(){var r=function(){!function(t){t.fromAce=function(t){var r=[];return t.forEach(function(t){var e=t.range;"insertText"==t.action&&r.push([1,e.start.row,e.start.column,e.end.row,e.end.column,t.text]),"removeText"==t.action&&r.push([2,e.start.row,e.start.column,e.end.row,e.end.column,t.text]),"insertLines"==t.action&&r.push([3,e.start.row,e.start.column,e.end.row,e.end.column,t.lines]),"removeLines"==t.action&&r.push([4,e.start.row,e.start.column,e.end.row,e.end.column,t.lines,t.nl])}),r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.reverse=function(t){var r=[];return t.forEach(function(t){{var e=t.slice();e[1],e[2],e[3],e[4]}return 1==e[0]?(e[0]=2,void r.unshift(e)):2==e[0]?(e[0]=1,void r.unshift(e)):3==e[0]?(e[0]=4,void r.unshift(e)):4==e[0]?(e[0]=3,void r.unshift(e)):void 0}),r},t.runToAce=function(t){var r=[],e=["","insertText","removeText","insertLines","removeLines"];return t.forEach(function(t){var i={action:e[t[0]],range:{start:{row:t[1],column:t[2]},end:{row:t[3],column:t[4]}}};t[0]<3?i.text=t[5]:i.lines=t[5],4==t[0]&&(i.nl=t[6]||"\n"),r.push(i)}),r},t.runToLineObj=function(t,r){r.forEach(function(r){var e=r[1],i=r[2],n=r[3],a=r[4];if(1==r[0])if("\n"==r[5]){var s=t.item(e);if(s){var o=s.text();s.text(o.slice(0,i));var _={text:o.slice(i)||""};t.insertAt(e+1,_)}else t.insertAt(e,{text:""}),t.insertAt(e+1,{text:""})}else{var s=t.item(e);if(s){var o=s.text();s.text(o.slice(0,i)+r[5]+o.slice(i))}else t.insertAt(e,{text:r[5]})}if(2==r[0])if("\n"==r[5]){var d=t.item(e),c=t.item(e+1),f="",u="";d&&(f=d.text()),c&&(u=c.text()),d?d.text(f+u):t.insertAt(e,{text:""}),c&&c.remove()}else{var s=t.item(e),o=s.text();s.text(o.slice(0,i)+o.slice(a))}if(3==r[0])for(var h=n-e,l=0;h>l;l++)t.insertAt(e+l,{text:r[5][l]});if(4==r[0])for(var h=n-e,l=0;h>l;l++){var s=t.item(e);s.remove()}})},t.runToString=function(t,r){if(!r||"undefined"==typeof t)return"";t+="";var e=t.split("\n");return r.forEach(function(t){var r=t[1],i=t[2],n=t[3],a=t[4];if(1==t[0])if("\n"==t[5]){var s=e[r]||"";e[r]=s.slice(0,i);var o=s.slice(i)||"";e.splice(r+1,0,o)}else{var s=e[r]||"";e[r]=s.slice(0,i)+t[5]+s.slice(i)}if(2==t[0])if("\n"==t[5]){var _=e[r]||"",d=e[r+1]||"";e[r]=_+d,e.splice(r+1,1)}else{var s=e[r]||"";e[r]=s.slice(0,i)+s.slice(a)}if(3==t[0])for(var c=n-r,f=0;c>f;f++)e.splice(r+f,0,t[5][f]);if(4==t[0])for(var c=n-r,f=0;c>f;f++)e.splice(r,1)}),e.join("\n")},t.simplify=function(t){var r,e=[],i=null;return t.forEach(function(t){r&&1==t[0]&&1==r[0]&&t[3]==t[1]&&r[1]==t[1]&&r[3]==t[3]&&r[4]==t[2]?i?(i[3]=t[3],i[4]=t[4],i[5]=i[5]+t[5]):(i=[],i[0]=1,i[1]=r[1],i[2]=r[2],i[3]=t[3],i[4]=t[4],i[5]=r[5]+t[5]):(i&&(e.push(i),i=null),1==t[0]?i=t.slice():e.push(t)),r=t}),i&&e.push(i),e}}(this)},e=function(t,r,i,n,a,s,o,_){var d,c=this;if(!(c instanceof e))return new e(t,r,i,n,a,s,o,_);var f=[t,r,i,n,a,s,o,_];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){d=t.apply(c,f)}),"function"==typeof d){if(d._classInfo.name!=e._classInfo.name)return new d(t,r,i,n,a,s,o,_)}else if(d)return d;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,f)}):"function"==typeof c.init&&c.init.apply(c,f)};e._classInfo={name:"aceCmdConvert"},e.prototype=new r;var i=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){var r,i,n,a,s;t._cmd_aceCmd=function(t,r){var i=this._find(t[4]),a=t[1];if(!i||!a)return!1;if("string"!=typeof i.data[a])return!1;var s=e();i.data[a]=s.runToString(i.data[a],t[2]),n=r;var o=[4,a,i.data[a],null,t[4]];return this._cmd(o,i,null),r?this._cmd(t,i,null):this.writeCommand(t),n=!1,this._fireListener(i,a),!0},t._cmd_createArray=function(t,r){var e=t[1];if(!e)return{error:21,cmd:t,text:"Object ID was null or undefined"};var i=this._getObjectHash();if(i[e])return{error:22,cmd:t,text:"Object with same ID ("+e+") was alredy created"};var n={data:[],__id:e};return i[n.__id]=n,this._data.__orphan.push(n),r||this.writeCommand(t,n),!0},t._cmd_createObject=function(t,r){var e=t[1];if(!e)return{error:11,cmd:t,text:"Object ID was null or undefined"};var i=this._getObjectHash();if(i[e])return{error:12,cmd:t,text:"Object with same ID ("+e+") was alredy created"};var n={data:{},__id:e};return i[n.__id]=n,this._data.__orphan.push(n),r||this.writeCommand(t,n),!0},t._cmd_moveToIndex=function(t,r){var e,n=this._find(t[4]),a=n.data.length,s=0;if(!n)return{error:2,cmd:1,text:"Object with ID ("+t[4]+") did not exist"};var o=null;for(s=0;a>s;s++){var _=n.data[s];if(_.__id==t[1]){e=_,o=s;break}}if(o!=t[3])return{error:121,cmd:t,text:"The old index was not what expected: "+o+" cmd have "+t[3]};if(!e)return{error:122,cmd:t,text:"Object to be moved ("+t[1]+") was not in the array"};var d=parseInt(t[2]);return isNaN(d)?{error:123,cmd:t,text:"Target index ("+d+") was not a number"}:n.data.length<=s||0>s?{error:124,cmd:t,text:"Invalid original index ("+s+") given"}:(i.fromIndex=s,n.data.splice(s,1),n.data.splice(d,0,e),this._cmd(t,null,t[1]),r||this.writeCommand(t),!0)},t._cmd_pushToArray=function(t,r){{var e=this._find(t[4]),i=this._find(t[2]),n=parseInt(t[1]);t[3],e.data.length}if(!e)return{error:71,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!i)return{error:72,cmd:t,text:"Did not find object with ID ("+t[2]+") "};if(i.__p)return{error:73,cmd:t,text:"The object already had a parent - need to remove first ("+t[2]+") "};if(isNaN(n))return{error:74,cmd:t,text:"toIndex was not a number"};if(!this.isArray(e.data))return{error:75,cmd:t,text:"Target Object was not an array"};if(n>e.data.length||0>n)return{error:76,cmd:t,text:"toIndex out of range"};e.data.splice(n,0,i),i.__p=e.__id,this._cmd(t,null,t[2]);var a=this._data.__orphan.indexOf(i);return a>=0&&this._data.__orphan.splice(a,1),r||this.writeCommand(t),!0},t._cmd_removeObject=function(t,r){var e=this._find(t[4]),i=this._find(t[2]),n=parseInt(t[1]);if(!e)return{error:81,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!i)return{error:82,cmd:t,text:"Did not find object with ID ("+t[2]+") "};if(!i.__p)return{error:83,cmd:t,text:"The removed item did not have a parent ("+t[2]+") "};var a=e.data.indexOf(i);if(isNaN(n))return{error:84,cmd:t,text:"oldPosition was not a number"};if(n!=a)return{error:85,cmd:t,text:"oldPosition was not same as current position"};e.data.splice(a,1),this._cmd(t,null,t[2]),i.__p=null;var s=this._data.__orphan.indexOf(i);return 0>s&&this._data.__orphan.push(i),r||this.writeCommand(t),!0},t._cmd_setMeta=function(t,r){var e=this._find(t[4]),i=t[1];return i?"data"==i?!1:"__id"==i?!1:e?e[i]==t[2]?!1:(e[i]=t[2],this._cmd(t,e,null),r||this.writeCommand(t),!0):!1:!1},t._cmd_setProperty=function(t,r){var e=this._find(t[4]),i=t[1];if(!e)return{error:41,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!i)return{error:42,cmd:t,text:"The property was not defined ("+t[1]+") "};var n=e.data[i];if(n==t[2])return{error:43,cmd:t,text:"Trying to set the same value to the object twice"};if("undefined"!=typeof n){if(n!=t[3])return{error:44,cmd:t,text:"The old value was not the same as the current value"}}else if(this.isObject(n)||this.isArray(n))return{error:45,cmd:t,text:"Trying to set Object or Array value to a scalar property"};return e.data[i]=t[2],this._cmd(t,e,null),r||this.writeCommand(t),this._fireListener(e,i),!0},t._cmd_setPropertyObject=function(t,r){var e=this._find(t[4]),i=t[1],n=this._find(t[2]);if(!e)return{error:51,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!i)return{error:52,cmd:t,text:"The property was not defined ("+t[1]+") "};if(!n)return{error:53,cmd:t,text:"Could not find the Object to be set with ID ("+t[2]+") "};if("undefined"!=typeof e.data[i])return{error:54,cmd:t,text:"The property ("+t[1]+") was already set, try unsetting first "};e.data[i]=n,n.__p=e.__id,this._cmd(t,null,t[2]);var a=this._data.__orphan.indexOf(n);return a>=0&&this._data.__orphan.splice(a,1),r||(this._moveCmdListToParent(n),this.writeCommand(t)),!0},t._cmd_unsetProperty=function(t,r){var e=this._find(t[4]),i=t[1];return e?i?this.isArray(e.data[i])?{error:103,cmd:t,text:"The Object data was Array ("+t[4]+") "}:(delete e.data[i],r||this.writeCommand(t),!0):{error:102,cmd:t,text:"The property was not defined ("+t[1]+") "}:{error:101,cmd:t,text:"Did not find object with ID ("+t[4]+") "}},t._fireListener=function(t,e){if(r){var i=t.__id+"::"+e,n=r[i];n&&n.forEach(function(r){r(t,t.data[e])})}},t._moveCmdListToParent=function(){},t._reverse_aceCmd=function(t){var r=this._find(t[4]),i=t[1],n=e(),a=n.reverse(t[2]),s=[4,i,r.data[i],null,t[4]],o=[13,i,a,null,t[4]],_=n.runToString(r.data[i],a);r.data[i]=_,this._cmd(s),this._cmd(o)},t._reverse_createObject=function(t){var r=t[1],e=this._getObjectHash(),i=e[r];delete e[r];var n=this._data.__orphan.indexOf(i);n>=0&&this._data.__orphan.splice(n,1)},t._reverse_moveToIndex=function(t){var r,e=this._find(t[4]),i=e.data.length,n=0,a=null;for(n=0;i>n;n++){var s=e.data[n];if(s.__id==t[1]){r=s,a=n;break}}if(a!=t[2])throw"_reverse_moveToIndex with invalid index value";if(r){var o=parseInt(t[3]);e.data.splice(n,1),e.data.splice(o,0,r);var _=t.slice();_[2]=o,_[3]=t[2],this._cmd(_,null,_[1])}},t._reverse_pushToArray=function(t){{var r=this._find(t[4]),e=this._find(t[2]);r.data.length}if(r&&e){var i=r.data.length-1,n=r.data[i];if(n.__id==t[2]){var a=[8,i,n.__id,null,r.__id];r.data.splice(i,1),this._cmd(a,null,a[2])}}},t._reverse_removeObject=function(t){{var r=this._find(t[4]),e=this._find(t[2]),i=t[1];r.data.indexOf(e)}if(r&&e){r.data.splice(i,0,e);var n=[7,i,t[2],null,t[4]];this._cmd(n,null,t[2]);var a=this._data.__orphan.indexOf(e);a>=0&&this._data.__orphan.splice(a,1),e.__p=t[4]}},t._reverse_setMeta=function(t){var r=this._find(t[4]),e=t[1];if(r){var i=[3,e,t[3],t[2],t[4]];r[e]=t[3],this._cmd(i)}},t._reverse_setProperty=function(t){var r=this._find(t[4]),e=t[1];if(r){var i=[4,e,t[3],t[2],t[4]];r.data[e]=t[3],this._cmd(i)}},t._reverse_setPropertyObject=function(t){var r=this._find(t[4]),e=t[1],i=this._find(t[2]);if(r&&i){delete r.data[e],i.__p=null;var n=[10,e,null,null,t[4]];this._cmd(n)}},t._reverse_unsetProperty=function(t){var r=this._find(t[4]),e=this._find(t[2]),i=t[1];if(r&&i&&e){r.data[i]=e,e.__p=r.__id;var n=[5,i,e.__id,0,t[4]];this._cmd(n,null,e.__id)}},t.execCmd=function(t,r,e){try{if(!this.isArray(t))return!1;var i=a[t[0]];if(i){var n=i.apply(this,[t,r]);return n!==!0||e||this.writeLocalJournal(t),n}return{error:199,text:"Invalid command"}}catch(s){var o="";return s&&s.message&&(o=s.message),{error:199,cmd:t,text:"Exception raised "+o}}},t.getJournalCmd=function(t){return this._journal[t]},t.getJournalLine=function(){return this._journalPointer},t.getLocalJournal=function(){return this._journal},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(r={},i={}),a||(s=new Array(30),a=new Array(30),a[1]=this._cmd_createObject,a[2]=this._cmd_createArray,a[3]=this._cmd_setMeta,a[4]=this._cmd_setProperty,a[5]=this._cmd_setPropertyObject,a[7]=this._cmd_pushToArray,a[8]=this._cmd_removeObject,a[10]=this._cmd_unsetProperty,a[12]=this._cmd_moveToIndex,a[13]=this._cmd_aceCmd,s[1]=this._reverse_createObject,s[3]=this._reverse_setMeta,s[4]=this._reverse_setProperty,s[5]=this._reverse_setPropertyObject,s[7]=this._reverse_pushToArray,s[8]=this._reverse_removeObject,s[10]=this._reverse_unsetProperty,s[12]=this._reverse_moveToIndex,s[13]=this._reverse_aceCmd)}),t.redo=function(t){var r=this.getJournalLine();for(t=t||1;t-->0;){var e=this._journal[r];if(!e)return;this.execCmd(e,!1,!0),r++,this._journalPointer++}},t.reverseCmd=function(t){console.log("reversing command ",t);var r=s[t[0]];if(r){var e=r.apply(this,[t]);return e}},t.reverseNLines=function(t){for(var r=this.getJournalLine();r-1>=0&&t-->0;){var e=this._journal[r-1];this.reverseCmd(e),r--,this._journalPointer--}},t.reverseToLine=function(t){for(var r=this.getJournalLine();r-1>=0&&r>t;){var e=this._journal[r-1];this.reverseCmd(e),r--,this._journalPointer--}},t.undo=function(t){0!==t&&("undefined"==typeof t&&(t=1),this.reverseNLines(t))},t.writeLocalJournal=function(t){this._journal&&(this._journal.length>this._journalPointer&&(this._journal.length=this._journalPointer),this._journal.push(t),this._journalPointer++)}}(this),function(t){var r,e;t._addToCache=function(t){t&&t.__id&&(this._objectHash[t.__id]=t)},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){return r||(r={}),r[t]?r[t]:void(r[t]=this)}),t._cmd=function(t,r,e){var i=t[0],n=t[4];this._wCmd(i,n,t),e&&e!=n&&this._wCmd(i,e,t)},t._createModelCommands=function(t,r,e){e||(e=[]);var i;if(i=t.data&&t.__id?t.data:t,this.isObject(i)||this.isArray(i)){var n;if(n=t.__id?t:{data:i,__id:this.guid()},this.isArray(i))var a=[2,n.__id,[],null,n.__id];else var a=[1,n.__id,{},null,n.__id];r&&(n.__p=r.__id),e.push(a);for(var s in i)if(i.hasOwnProperty(s)){var o=i[s];if(this.isObject(o)||this.isArray(o)){var _=this._createModelCommands(o,n,e),a=[5,s,_.__id,null,n.__id];e.push(a)}else{var a=[4,s,o,null,n.__id];e.push(a)}}return n}},t._createNewModel=function(t,r){if(this.isObject(t)||this.isArray(t)){var e={data:t,__id:this.guid()};if(this._objectHash[e.__id]=e,this.isArray(t))var i=[2,e.__id,[],null,e.__id];else var i=[1,e.__id,{},null,e.__id];r&&(e.__p=r.__id),this.writeCommand(i,e);for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];if(this.isObject(a)||this.isArray(a)){var s=this._createNewModel(a,e);e.data[n]=s;var i=[5,n,s.__id,null,e.__id];this.writeCommand(i,e),this._moveCmdListToParent(s)}else{var i=[4,n,a,null,e.__id];this.writeCommand(i,e)}}return e}},t._find=function(t){return this._objectHash[t]},t._findObjects=function(t,r){if(!t)return null;if(!this.isObject(t))return t;t=this._wrapData(t),t.__id&&(this._objectHash[t.__id]=t);if(r&&(t.__p=r),t.data){var e=t.data;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(this.isObject(n)){var a=this._findObjects(n,t.__id);a!==n&&(t.data[i]=a)}}}return t},t._getObjectHash=function(){return this._objectHash},t._prepareData=function(t){var r=this._wrapData(t);return this._objectHash[r.__id]||(r=this._findObjects(r)),r},t._wCmd=function(t,r,i){if(this._workers[t]&&this._workers[t][r]){var n=this._workers[t][r],a=i[1],s=n["*"],o=n[a];s&&s.forEach(function(t){var r=t[0],n=t[1],a=e[r];a&&a(i,n)}),o&&o.forEach(function(t){var r=t[0],n=t[1],a=e[r];a&&a(i,n)})}},t._wrapData=function(t){if(t&&t._wrapData)return t._data;if(t.__id&&t.data)return t;var r=this._createNewModel(t);return r},t.createWorker=function(t,r,e){var i=r[0],n=r[4];this._workers[i]||(this._workers[i]={}),this._workers[i][n]||(this._workers[i][n]={});var a=this._workers[i][n],s=r[1];s||(s="*"),a[s]||(a[s]=[]),a[s].push([t,e])},t.getData=function(){return this._data},t.indexOf=function(t){if(t||(t=this._data),this.isObject(t)||(t=this._find(t)),t){var r=this._find(t.__p);if(r&&this.isArray(r.data))return r.data.indexOf(t)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,r,e){if(r){this._objectHash||(this._objectHash={});var i=this;this._channelId=t,this._data=r,this._data.__orphan||(this._data.__orphan=[]),this._workers={},this._journal=e||[],this._journalPointer=this._journal.length;var n=this._findObjects(r);n!=r&&(this._data=n),e&&this.isArray(e)&&e.forEach(function(t){i.execCmd(t,!0)})}}),t.setWorkerCommands=function(t){e||(e={});for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},t.toPlainData=function(t){if("undefined"==typeof t&&(t=this._data),!this.isObject(t))return t;var r;if(this.isArray(t.data)){r=[];for(var e=t.data.length,i=0;e>i;i++)r[i]=this.toPlainData(t.data[i])}else{r={};for(var n in t.data)t.data.hasOwnProperty(n)&&(r[n]=this.toPlainData(t.data[n]))}return r},t.writeCommand=function(t){this._cmdBuffer||(this._cmdBuffer=[]),this._cmdBuffer.push(t)}}(this)},n=function(t,r,e,i,a,s,o,_){var d,c=this;if(!(c instanceof n))return new n(t,r,e,i,a,s,o,_);var f=[t,r,e,i,a,s,o,_];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){d=t.apply(c,f)}),"function"==typeof d){if(d._classInfo.name!=n._classInfo.name)return new d(t,r,e,i,a,s,o,_)}else if(d)return d;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,f)}):"function"==typeof c.init&&c.init.apply(c,f)};n._classInfo={name:"_channelData"},n.prototype=new i,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t._channelData=n,this._channelData=n):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._channelData=n:this._channelData=n}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},e=function(t,r,i,n,a,s,o,_){var d,c=this;if(!(c instanceof e))return new e(t,r,i,n,a,s,o,_);var f=[t,r,i,n,a,s,o,_];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){d=t.apply(c,f)}),"function"==typeof d){if(d._classInfo.name!=e._classInfo.name)return new d(t,r,i,n,a,s,o,_)}else if(d)return d;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,f)}):"function"==typeof c.init&&c.init.apply(c,f)};e._classInfo={name:"channelObjects"},e.prototype=new r,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());