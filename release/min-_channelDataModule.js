(function(){var t={},r=function(){var r=function(){!function(t){t.fromAce=function(t){var r=[];return t.forEach(function(t){var i=t.range;"insertText"==t.action&&r.push([1,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"removeText"==t.action&&r.push([2,i.start.row,i.start.column,i.end.row,i.end.column,t.text]),"insertLines"==t.action&&r.push([3,i.start.row,i.start.column,i.end.row,i.end.column,t.lines]),"removeLines"==t.action&&r.push([4,i.start.row,i.start.column,i.end.row,i.end.column,t.lines,t.nl])}),r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.reverse=function(t){var r=[];return t.forEach(function(t){{var i=t.slice();i[1],i[2],i[3],i[4]}return 1==i[0]?(i[0]=2,void r.unshift(i)):2==i[0]?(i[0]=1,void r.unshift(i)):3==i[0]?(i[0]=4,void r.unshift(i)):4==i[0]?(i[0]=3,void r.unshift(i)):void 0}),r},t.runToAce=function(t){var r=[],i=["","insertText","removeText","insertLines","removeLines"];return t.forEach(function(t){var e={action:i[t[0]],range:{start:{row:t[1],column:t[2]},end:{row:t[3],column:t[4]}}};t[0]<3?e.text=t[5]:e.lines=t[5],4==t[0]&&(e.nl=t[6]||"\n"),r.push(e)}),r},t.runToLineObj=function(t,r){r.forEach(function(r){var i=r[1],e=r[2],n=r[3],a=r[4];if(1==r[0])if("\n"==r[5]){var s=t.item(i);if(s){var o=s.text();s.text(o.slice(0,e));var _={text:o.slice(e)||""};t.insertAt(i+1,_)}else t.insertAt(i,{text:""}),t.insertAt(i+1,{text:""})}else{var s=t.item(i);if(s){var o=s.text();s.text(o.slice(0,e)+r[5]+o.slice(e))}else t.insertAt(i,{text:r[5]})}if(2==r[0])if("\n"==r[5]){var c=t.item(i),d=t.item(i+1),f="",u="";c&&(f=c.text()),d&&(u=d.text()),c?c.text(f+u):t.insertAt(i,{text:""}),d&&d.remove()}else{var s=t.item(i),o=s.text();s.text(o.slice(0,e)+o.slice(a))}if(3==r[0])for(var h=n-i,l=0;h>l;l++)t.insertAt(i+l,{text:r[5][l]});if(4==r[0])for(var h=n-i,l=0;h>l;l++){var s=t.item(i);s.remove()}})},t.runToString=function(t,r){if(!r||"undefined"==typeof t)return"";t+="";var i=t.split("\n");return r.forEach(function(t){var r=t[1],e=t[2],n=t[3],a=t[4];if(1==t[0])if("\n"==t[5]){var s=i[r]||"";i[r]=s.slice(0,e);var o=s.slice(e)||"";i.splice(r+1,0,o)}else{var s=i[r]||"";i[r]=s.slice(0,e)+t[5]+s.slice(e)}if(2==t[0])if("\n"==t[5]){var _=i[r]||"",c=i[r+1]||"";i[r]=_+c,i.splice(r+1,1)}else{var s=i[r]||"";i[r]=s.slice(0,e)+s.slice(a)}if(3==t[0])for(var d=n-r,f=0;d>f;f++)i.splice(r+f,0,t[5][f]);if(4==t[0])for(var d=n-r,f=0;d>f;f++)i.splice(r,1)}),i.join("\n")},t.simplify=function(t){var r,i=[],e=null;return t.forEach(function(t){r&&1==t[0]&&1==r[0]&&t[3]==t[1]&&r[1]==t[1]&&r[3]==t[3]&&r[4]==t[2]?e?(e[3]=t[3],e[4]=t[4],e[5]=e[5]+t[5]):(e=[],e[0]=1,e[1]=r[1],e[2]=r[2],e[3]=t[3],e[4]=t[4],e[5]=r[5]+t[5]):(e&&(i.push(e),e=null),1==t[0]?e=t.slice():i.push(t)),r=t}),e&&i.push(e),i}}(this)},i=function(t,r,e,n,a,s,o,_){var c,d=this;if(!(d instanceof i))return new i(t,r,e,n,a,s,o,_);var f=[t,r,e,n,a,s,o,_];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){c=t.apply(d,f)}),"function"==typeof c){if(c._classInfo.name!=i._classInfo.name)return new c(t,r,e,n,a,s,o,_)}else if(c)return c;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,f)}):"function"==typeof d.init&&d.init.apply(d,f)};i._classInfo={name:"aceCmdConvert"},i.prototype=new r;var e=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){var r,i,e,n,a,s,o;t._createModelCommands=function(t,r,i){i||(i=[]);var e;if(e=t.data&&t.__id?t.data:t,this.isObject(e)||this.isArray(e)){var n;if(n=t.__id?t:{data:e,__id:this.guid()},this.isArray(e))var a=[2,n.__fork||n.__id,[],null,n.__fork||n.__id];else var a=[1,n.__fork||n.__id,{},null,n.__fork||n.__id];r&&(n.__p=r.__id),i.push(a);for(var s in e)if(e.hasOwnProperty(s)){var o=e[s];if(this.isObject(o)||this.isArray(o)){var _=this._createModelCommands(o,n,i),a=[5,s,_.__fork||_.__id,null,n.__fork||n.__id];i.push(a)}else{var a=[4,s,o,null,n.__fork||n.__id];i.push(a)}}return n}},t.addedObjects=function(){var t=[];for(var r in e)e.hasOwnProperty(r)&&(i[r]||(t.push(r),s[r]=e[r]));return t},t.commonObjects=function(){var t=[];for(var n in r)i[n]&&e[n]&&t.push(n);return t},t.compareFiles=function(t,_){i={},e={},r={},n={},a={},s={},o={},this.findObjects(t,i),this.findObjects(_,e);var c={missing:this.missingObjects(),added:this.addedObjects(),common:this.commonObjects(),cMod:[],cmds:[]},d=this;c.common.forEach(function(t){var r=d.objectDiff(i[t],e[t]);c.cMod.push(r)});var d=this;return c.added.forEach(function(t){var i=[],e=r[t];d._createModelCommands(e,null,i),i.forEach(function(t){c.cmds.push(t)})}),c.cMod.forEach(function(t){t.cmds.forEach(function(t){c.cmds.push(t)})}),c},t.findObjects=function(t,i){if(t&&t.__id&&(i[t.__fork||t.__id]=t,r[t.__fork||t.__id]=t,n[t.__id]=t),t.data){var e=t.data;for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];this.isObject(s)&&(o[s.__fork||s.__id]=t.__fork||t.__id,this.findObjects(s,i))}}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.missingObjects=function(){var t=[];for(var r in i)i.hasOwnProperty(r)&&(e[r]||(a[r]=i[r],t.push(r)));return t},t.objectDiff=function(t,i){var e={modified:[],posMoved:[],sourcesAndTargets:[],cmds:[]};if(t.data&&i.data&&this.isObject(t.data)&&!this.isArray(t.data)){var n=t.data,_={};for(var c in i.data)if(i.data.hasOwnProperty(c)){var d=n[c],f=t.__fork||t.__id;if(!this.isObject(d)&&!this.isArray(d)){_[c]=!0;var u=i.data[c];i.data[c]!=d&&(this.isObject(d)||this.isObject(u)?e.cmds.push(u&&u.__id?[5,c,i.data[c].__id,null,f]:[10,c,d.__id,null,f]):(e.modified.push({id:f,prop:c,from:d,to:i.data[c]}),e.cmds.push([4,c,i.data[c],d,f])))}}for(var c in t.data)if(t.data.hasOwnProperty(c)){if(_[c])continue;var d=t.data[c],f=t.__id;if(this.isObject(d)&&!this.isArray(d)){var u=i.data[c];!u&&d&&d.__id&&e.cmds.push([10,c,d.__id,null,f])}}}if(this.isArray(t.data)){for(var h=t.data,l=i.data,v=[],m=[],p=h.length,y=l.length,b=0;p>b;b++){var j=h[b];if(this.isObject(j)){var w=j.__fork||j.__id;a[w]?e.cmds.push([8,0,w,0,o[w]]):v.push(w)}}for(var O={},x={},I={},b=0;y>b;b++){var j=l[b];if(this.isObject(j)){var w=j.__fork||j.__id;O[w]=b,x[b]=w,s[w]&&(v.push(w),e.cmds.push([7,b,w,0,o[w]])),m.push(w)}}var g=[],b=0;v.forEach(function(t){g.push(O[t]),I[t]=b,b++}),e.restackIndex=O,e.restackList=g,e.reverseIndex=x,e.restack=this.restackOps(g);var C=[],A=v.slice();e.restack.forEach(function(t){if("a"==t[0]){var i=x[t[1]],n=x[t[2]],a=(O[n],A.indexOf(i));A.splice(a,1);var s=A.indexOf(n);A.splice(s,0,i);{r[i]}e.cmds.push([12,i,s,a,o[i]])}else{var i=x[t[1]],n=x[t[2]],a=(O[n],A.indexOf(i));A.splice(a,1);var s=A.indexOf(n)+1;A.splice(s,0,i),e.cmds.push([12,i,s,a,o[i]])}}),e.stackCmds=C,e.sourceArrayWork=A,e.sourcesAndTargets.push([v,m])}return e},t.restackOps=function(t){function r(t){for(var r=t.slice(0),e=t.slice(0),n=t.slice(0).sort(function(t,r){return t-r}),a={},s={},o=0;o<e.length;o++){var _=n.indexOf(e[o]);a[e[o]]=_,s[_]=e[o],r[o]=_}var c=r.slice(0).sort(function(t,r){return t-r}),d=r[0],f=r[0],u=[],h=0,l=function(){for(var t=0,i=r.length,e=0;i>t;t++){var n=r[t];n>f&&(f=n),d>n&&(d=n),t>0&&u.push(c[t]-c[t-1]),t>0&&(h+=Math.abs(c[t]-c[t-1])),e+=Math.abs(n-c[t])}return h/=i,e/i}();u.sort(function(t,r){return t-r});for(var v=(u[0],function(t){for(var i=function(i,e,n){var a=[],s=r.length;for(e||(e=0);s>i;i++){var o=r[i];if(o-n!=1){var _=i+e;0>_&&(_=0),_>=s&&(_=s-1),t(o,c[_],o,n,i,s)&&(r[i+1]&&r[i+1]<o&&r[i+1]>n||(a.push(o),n=o))}else a.push(o),n=o}return a},e=[],n=0;.1>n;){for(var a=-5;5>=a;a++)e.push(i(Math.floor(r.length*n),a,d-1));n+=.05}return e.sort(function(t,r){return r.length-t.length}),e[0]}),m=[v(function(t,r,i,e,n,a){return e>i?!1:n>0&&Math.abs(i-e)>u[n-1]?!1:Math.abs(i-e)>l?!1:Math.abs(t-r)<=l*(n/a)&&i>=e?!0:Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e,n,a){return e>i?!1:Math.abs(i-e)>l?!1:Math.abs(t-r)<=l*(n/a)&&i>=e?!0:Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e,n,a){return e>i?!1:Math.abs(i-e)>l?!1:Math.abs(t-r)<=l*(n/a)&&i>=e?!0:Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e,n,a){return e>i?!1:Math.abs(t-r)<=l*(n/a)&&i>=e?!0:Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e,n,a){return e>i?!1:Math.abs(t-r)<=l&&i>=e?!0:Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e){return e>i?!1:Math.abs(i-e)<h?!0:Math.abs(t-r)<=h&&i>=e?!0:!1}),v(function(t,r,i,e){return i>e?!0:!1}),v(function(t,r,i,e){return e>i?!1:Math.abs(i-e)>l?!1:Math.abs(t-r)<=l&&i>=e?!0:!1}),v(function(t,r,i,e,n,a){return e>i?!1:n>0&&Math.abs(i-e)>l?!1:Math.abs(t-r)<=l*(n/a)&&i>=e?!0:n>0&&Math.abs(e-i)<=l*(n/a)&&i>=e?!0:!1}),v(function(t,r,i,e){if(e>i)return!1;if(e>=d){if(i>=e)return!0}else if(i==d)return!0;return!1})],p=[],y=0,o=0;o<m.length;o++){var b=m[o];b.length>y&&(p=b,y=b.length)}0==p.length&&(p=[c[Math.floor(c.length/2)]]);{var j=[],w=[];!function(){for(var t=d,i=p[0],e=p.length,n=r.indexOf(i),a=0,s=0,o=r.length;o>s;s++){var _=r[s];_>=t&&i>=_&&n>=s?(j.push(_),t=_):w.push(_),_==i&&(t=_,e-1>a?(a++,i=p[a],n=r.indexOf(i)):(i=f,n=o+1))}}()}w.sort(function(t,r){return t-r});!function(){for(var t=0,r=0,e=j[0],n=w.length;n>t;){var a=j[r],o=w[t];if("undefined"==typeof a){for(;n>t;)i.push(["b",s[o],s[e]]),e=o,t++,o=w[t];return}o>a?(e=a,r++):(i.push(["a",s[o],s[a]]),t++)}}();return r}var i=[];return r(t),i}}(this)},n=function(t,r,i,e,a,s,o,_){var c,d=this;if(!(d instanceof n))return new n(t,r,i,e,a,s,o,_);var f=[t,r,i,e,a,s,o,_];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){c=t.apply(d,f)}),"function"==typeof c){if(c._classInfo.name!=n._classInfo.name)return new c(t,r,i,e,a,s,o,_)}else if(c)return c;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,f)}):"function"==typeof d.init&&d.init.apply(d,f)};n._classInfo={name:"diffEngine"},n.prototype=new e;var a=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){var r,e,n,a,s;t._cmd_aceCmd=function(t,r){var e=this._find(t[4]),a=t[1];if(!e||!a)return!1;if("string"!=typeof e.data[a])return!1;var s=i();e.data[a]=s.runToString(e.data[a],t[2]),n=r;var o=[4,a,e.data[a],null,t[4]];return this._cmd(o,e,null),r?this._cmd(t,e,null):this.writeCommand(t),n=!1,this._fireListener(e,a),!0},t._cmd_createArray=function(t,r){var i=t[1];if(!i)return{error:21,cmd:t,text:"Object ID was null or undefined"};var e=this._getObjectHash();if(e[i])return{error:22,cmd:t,text:"Object with same ID ("+i+") was alredy created"};var n={data:[],__id:i};return e[n.__id]=n,this._data.__orphan.push(n),r||this.writeCommand(t,n),!0},t._cmd_createObject=function(t,r){var i=t[1];if(!i)return{error:11,cmd:t,text:"Object ID was null or undefined"};var e=this._getObjectHash();if(e[i])return{error:12,cmd:t,text:"Object with same ID ("+i+") was alredy created"};var n={data:{},__id:i};return e[n.__id]=n,this._data.__orphan.push(n),r||this.writeCommand(t,n),!0},t._cmd_moveToIndex=function(t,r){var i,n=this._find(t[4]),a=n.data.length,s=0;if(!n)return{error:2,cmd:1,text:"Object with ID ("+t[4]+") did not exist"};var o=null;for(s=0;a>s;s++){var _=n.data[s];if(_.__id==t[1]){i=_,o=s;break}}if(o!=t[3])return{error:121,cmd:t,text:"The old index was not what expected: "+o+" cmd have "+t[3]};if(!i)return{error:122,cmd:t,text:"Object to be moved ("+t[1]+") was not in the array"};var c=parseInt(t[2]);return isNaN(c)?{error:123,cmd:t,text:"Target index ("+c+") was not a number"}:n.data.length<=s||0>s?{error:124,cmd:t,text:"Invalid original index ("+s+") given"}:(e.fromIndex=s,n.data.splice(s,1),n.data.splice(c,0,i),this._cmd(t,null,t[1]),r||this.writeCommand(t),!0)},t._cmd_pushToArray=function(t,r){{var i=this._find(t[4]),e=this._find(t[2]),n=parseInt(t[1]);t[3],i.data.length}if(!i)return{error:71,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!e)return{error:72,cmd:t,text:"Did not find object with ID ("+t[2]+") "};if(e.__p)return{error:73,cmd:t,text:"The object already had a parent - need to remove first ("+t[2]+") "};if(isNaN(n))return{error:74,cmd:t,text:"toIndex was not a number"};if(!this.isArray(i.data))return{error:75,cmd:t,text:"Target Object was not an array"};if(n>i.data.length||0>n)return{error:76,cmd:t,text:"toIndex out of range"};i.data.splice(n,0,e),e.__p=i.__id,this._cmd(t,null,t[2]);var a=this._data.__orphan.indexOf(e);return a>=0&&this._data.__orphan.splice(a,1),r||this.writeCommand(t),!0},t._cmd_removeObject=function(t,r){var i=this._find(t[4]),e=this._find(t[2]),n=parseInt(t[1]);if(!i)return{error:81,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!e)return{error:82,cmd:t,text:"Did not find object with ID ("+t[2]+") "};if(!e.__p)return{error:83,cmd:t,text:"The removed item did not have a parent ("+t[2]+") "};var a=i.data.indexOf(e);if(isNaN(n))return{error:84,cmd:t,text:"oldPosition was not a number"};if(n!=a)return{error:85,cmd:t,text:"oldPosition was not same as current position"};i.data.splice(a,1),this._cmd(t,null,t[2]),e.__p=null;var s=this._data.__orphan.indexOf(e);return 0>s&&this._data.__orphan.push(e),r||this.writeCommand(t),!0},t._cmd_setMeta=function(t,r){var i=this._find(t[4]),e=t[1];return e?"data"==e?!1:"__id"==e?!1:i?i[e]==t[2]?!1:(i[e]=t[2],this._cmd(t,i,null),r||this.writeCommand(t),!0):!1:!1},t._cmd_setProperty=function(t,r){var i=this._find(t[4]),e=t[1];if(!i)return{error:41,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!e)return{error:42,cmd:t,text:"The property was not defined ("+t[1]+") "};var n=i.data[e];if(n==t[2])return{error:43,cmd:t,text:"Trying to set the same value to the object twice"};if("undefined"!=typeof n){if(n!=t[3])return{error:44,cmd:t,text:"The old value was not the same as the current value"}}else if(this.isObject(n)||this.isArray(n))return{error:45,cmd:t,text:"Trying to set Object or Array value to a scalar property"};return i.data[e]=t[2],this._cmd(t,i,null),r||this.writeCommand(t),this._fireListener(i,e),!0},t._cmd_setPropertyObject=function(t,r){var i=this._find(t[4]),e=t[1],n=this._find(t[2]);if(!i)return{error:51,cmd:t,text:"Did not find object with ID ("+t[4]+") "};if(!e)return{error:52,cmd:t,text:"The property was not defined ("+t[1]+") "};if(!n)return{error:53,cmd:t,text:"Could not find the Object to be set with ID ("+t[2]+") "};if("undefined"!=typeof i.data[e])return{error:54,cmd:t,text:"The property ("+t[1]+") was already set, try unsetting first "};i.data[e]=n,n.__p=i.__id,this._cmd(t,null,t[2]);var a=this._data.__orphan.indexOf(n);return a>=0&&this._data.__orphan.splice(a,1),r||(this._moveCmdListToParent(n),this.writeCommand(t)),!0},t._cmd_unsetProperty=function(t,r){var i=this._find(t[4]),e=t[1];return i?e?this.isArray(i.data[e])?{error:103,cmd:t,text:"The Object data was Array ("+t[4]+") "}:(delete i.data[e],r||this.writeCommand(t),!0):{error:102,cmd:t,text:"The property was not defined ("+t[1]+") "}:{error:101,cmd:t,text:"Did not find object with ID ("+t[4]+") "}},t._fireListener=function(t,i){if(r){var e=t.__id+"::"+i,n=r[e];n&&n.forEach(function(r){r(t,t.data[i])})}},t._moveCmdListToParent=function(){},t._reverse_aceCmd=function(t){var r=this._find(t[4]),e=t[1],n=i(),a=n.reverse(t[2]),s=[4,e,r.data[e],null,t[4]],o=[13,e,a,null,t[4]],_=n.runToString(r.data[e],a);r.data[e]=_,this._cmd(s),this._cmd(o)},t._reverse_createObject=function(t){var r=t[1],i=this._getObjectHash(),e=i[r];delete i[r];var n=this._data.__orphan.indexOf(e);n>=0&&this._data.__orphan.splice(n,1)},t._reverse_moveToIndex=function(t){var r,i=this._find(t[4]),e=i.data.length,n=0,a=null;for(n=0;e>n;n++){var s=i.data[n];if(s.__id==t[1]){r=s,a=n;break}}if(a!=t[2])throw"_reverse_moveToIndex with invalid index value";if(r){var o=parseInt(t[3]);i.data.splice(n,1),i.data.splice(o,0,r);var _=t.slice();_[2]=o,_[3]=t[2],this._cmd(_,null,_[1])}},t._reverse_pushToArray=function(t){{var r=this._find(t[4]),i=this._find(t[2]);r.data.length}if(r&&i){var e=r.data.length-1,n=r.data[e];if(n.__id==t[2]){var a=[8,e,n.__id,null,r.__id];r.data.splice(e,1),this._cmd(a,null,a[2])}}},t._reverse_removeObject=function(t){{var r=this._find(t[4]),i=this._find(t[2]),e=t[1];r.data.indexOf(i)}if(r&&i){r.data.splice(e,0,i);var n=[7,e,t[2],null,t[4]];this._cmd(n,null,t[2]);var a=this._data.__orphan.indexOf(i);a>=0&&this._data.__orphan.splice(a,1),i.__p=t[4]}},t._reverse_setMeta=function(t){var r=this._find(t[4]),i=t[1];if(r){var e=[3,i,t[3],t[2],t[4]];r[i]=t[3],this._cmd(e)}},t._reverse_setProperty=function(t){var r=this._find(t[4]),i=t[1];if(r){var e=[4,i,t[3],t[2],t[4]];r.data[i]=t[3],this._cmd(e)}},t._reverse_setPropertyObject=function(t){var r=this._find(t[4]),i=t[1],e=this._find(t[2]);if(r&&e){delete r.data[i],e.__p=null;var n=[10,i,null,null,t[4]];this._cmd(n)}},t._reverse_unsetProperty=function(t){var r=this._find(t[4]),i=this._find(t[2]),e=t[1];if(r&&e&&i){r.data[e]=i,i.__p=r.__id;var n=[5,e,i.__id,0,t[4]];this._cmd(n,null,i.__id)}},t.execCmd=function(t,r,i){try{if(!this.isArray(t))return!1;var e=a[t[0]];if(e){var n=e.apply(this,[t,r]);return n!==!0||i||this.writeLocalJournal(t),n}return{error:199,text:"Invalid command"}}catch(s){var o="";return s&&s.message&&(o=s.message),{error:199,cmd:t,text:"Exception raised "+o}}},t.getJournalCmd=function(t){return this._journal[t]},t.getJournalLine=function(){return this._journalPointer},t.getLocalJournal=function(){return this._journal},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){r||(r={},e={}),a||(s=new Array(30),a=new Array(30),a[1]=this._cmd_createObject,a[2]=this._cmd_createArray,a[3]=this._cmd_setMeta,a[4]=this._cmd_setProperty,a[5]=this._cmd_setPropertyObject,a[7]=this._cmd_pushToArray,a[8]=this._cmd_removeObject,a[10]=this._cmd_unsetProperty,a[12]=this._cmd_moveToIndex,a[13]=this._cmd_aceCmd,s[1]=this._reverse_createObject,s[3]=this._reverse_setMeta,s[4]=this._reverse_setProperty,s[5]=this._reverse_setPropertyObject,s[7]=this._reverse_pushToArray,s[8]=this._reverse_removeObject,s[10]=this._reverse_unsetProperty,s[12]=this._reverse_moveToIndex,s[13]=this._reverse_aceCmd)}),t.redo=function(t){var r=this.getJournalLine();for(t=t||1;t-->0;){var i=this._journal[r];if(!i)return;this.execCmd(i,!1,!0),r++,this._journalPointer++}},t.reverseCmd=function(t){console.log("reversing command ",t);var r=s[t[0]];if(r){var i=r.apply(this,[t]);return i}},t.reverseNLines=function(t){for(var r=this.getJournalLine();r-1>=0&&t-->0;){var i=this._journal[r-1];this.reverseCmd(i),r--,this._journalPointer--}},t.reverseToLine=function(t){for(var r=this.getJournalLine();r-1>=0&&r>t;){var i=this._journal[r-1];this.reverseCmd(i),r--,this._journalPointer--}},t.undo=function(t){0!==t&&("undefined"==typeof t&&(t=1),this.reverseNLines(t))},t.writeLocalJournal=function(t){this._journal&&(this._journal.length>this._journalPointer&&(this._journal.length=this._journalPointer),this._journal.push(t),this._journalPointer++)}}(this),function(t){var r,i;t._addToCache=function(t){t&&t.__id&&(this._objectHash[t.__id]=t)},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){return r||(r={}),r[t]?r[t]:void(r[t]=this)}),t._cmd=function(t,r,i){var e=t[0],n=t[4];this._wCmd(e,n,t),i&&i!=n&&this._wCmd(e,i,t)},t._createModelCommands=function(t,r,i){i||(i=[]);var e;if(e=t.data&&t.__id?t.data:t,this.isObject(e)||this.isArray(e)){var n;if(n=t.__id?t:{data:e,__id:this.guid()},this.isArray(e))var a=[2,n.__id,[],null,n.__id];else var a=[1,n.__id,{},null,n.__id];r&&(n.__p=r.__id),i.push(a);for(var s in e)if(e.hasOwnProperty(s)){var o=e[s];if(this.isObject(o)||this.isArray(o)){var _=this._createModelCommands(o,n,i),a=[5,s,_.__id,null,n.__id];i.push(a)}else{var a=[4,s,o,null,n.__id];i.push(a)}}return n}},t._createNewModel=function(t,r){if(this.isObject(t)||this.isArray(t)){var i={data:t,__id:this.guid()};if(this._objectHash[i.__id]=i,this.isArray(t))var e=[2,i.__id,[],null,i.__id];else var e=[1,i.__id,{},null,i.__id];r&&(i.__p=r.__id),this.writeCommand(e,i);for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];if(this.isObject(a)||this.isArray(a)){var s=this._createNewModel(a,i);i.data[n]=s;var e=[5,n,s.__id,null,i.__id];this.writeCommand(e,i),this._moveCmdListToParent(s)}else{var e=[4,n,a,null,i.__id];this.writeCommand(e,i)}}return i}},t._find=function(t){return this._objectHash[t]},t._findObjects=function(t,r){if(!t)return null;if(!this.isObject(t))return t;t=this._wrapData(t),t.__id&&(this._objectHash[t.__id]=t);if(r&&(t.__p=r),t.data){var i=t.data;for(var e in i)if(i.hasOwnProperty(e)){var n=i[e];if(this.isObject(n)){var a=this._findObjects(n,t.__id);a!==n&&(t.data[e]=a)}}}return t},t._getObjectHash=function(){return this._objectHash},t._prepareData=function(t){var r=this._wrapData(t);return this._objectHash[r.__id]||(r=this._findObjects(r)),r},t._wCmd=function(t,r,e){if(this._workers[t]&&this._workers[t][r]){var n=this._workers[t][r],a=e[1],s=n["*"],o=n[a];s&&s.forEach(function(t){var r=t[0],n=t[1],a=i[r];a&&a(e,n)}),o&&o.forEach(function(t){var r=t[0],n=t[1],a=i[r];a&&a(e,n)})}},t._wrapData=function(t){if(t&&t._wrapData)return t._data;if(t.__id&&t.data)return t;var r=this._createNewModel(t);return r},t.createWorker=function(t,r,i){var e=r[0],n=r[4];this._workers[e]||(this._workers[e]={}),this._workers[e][n]||(this._workers[e][n]={});var a=this._workers[e][n],s=r[1];s||(s="*"),a[s]||(a[s]=[]),a[s].push([t,i])},t.getData=function(){return this._data},t.indexOf=function(t){if(t||(t=this._data),this.isObject(t)||(t=this._find(t)),t){var r=this._find(t.__p);if(r&&this.isArray(r.data))return r.data.indexOf(t)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,r,i){if(r){this._objectHash||(this._objectHash={});var e=this;this._channelId=t,this._data=r,this._data.__orphan||(this._data.__orphan=[]),this._workers={},this._journal=i||[],this._journalPointer=this._journal.length;var n=this._findObjects(r);n!=r&&(this._data=n),i&&this.isArray(i)&&i.forEach(function(t){e.execCmd(t,!0)})}}),t.setWorkerCommands=function(t){i||(i={});for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r])},t.toPlainData=function(t){if("undefined"==typeof t&&(t=this._data),!this.isObject(t))return t;var r;if(this.isArray(t.data)){r=[];for(var i=t.data.length,e=0;i>e;e++)r[e]=this.toPlainData(t.data[e])}else{r={};for(var n in t.data)t.data.hasOwnProperty(n)&&(r[n]=this.toPlainData(t.data[n]))}return r},t.writeCommand=function(t){this._cmdBuffer||(this._cmdBuffer=[]),this._cmdBuffer.push(t)}}(this)},s=function(t,r,i,e,n,a,o,_){var c,d=this;if(!(d instanceof s))return new s(t,r,i,e,n,a,o,_);var f=[t,r,i,e,n,a,o,_];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){c=t.apply(d,f)}),"function"==typeof c){if(c._classInfo.name!=s._classInfo.name)return new c(t,r,i,e,n,a,o,_)}else if(c)return c;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,f)}):"function"==typeof d.init&&d.init.apply(d,f)};s._classInfo={name:"_channelData"},s.prototype=new a,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t._channelData=s,this._channelData=s):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._channelData=s:this._channelData=s}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},i=function(t,r,e,n,a,s,o,_){var c,d=this;if(!(d instanceof i))return new i(t,r,e,n,a,s,o,_);var f=[t,r,e,n,a,s,o,_];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){c=t.apply(d,f)}),"function"==typeof c){if(c._classInfo.name!=i._classInfo.name)return new c(t,r,e,n,a,s,o,_)}else if(c)return c;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,f)}):"function"==typeof d.init&&d.init.apply(d,f)};i._classInfo={name:"channelObjects"},i.prototype=new r,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());